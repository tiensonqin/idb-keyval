var idbKeyval=function(e){"use strict";class t{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbName=e,this._storeName=t,this.id=`dbName:${e};;storeName:${t}`,this._init()}_init(){this._dbp||(this._dbp=new Promise((e,t)=>{const s=indexedDB.open(this._dbName);s.onerror=(()=>t(s.error)),s.onsuccess=(()=>e(s.result)),s.onupgradeneeded=(()=>{s.result.createObjectStore(this._storeName)})}))}_withIDBStore(e,t){return this._init(),this._dbp.then(s=>new Promise((r,i)=>{const o=s.transaction(this.storeName,e);o.oncomplete=(()=>r()),o.onabort=o.onerror=(()=>i(o.error)),t(o.objectStore(this.storeName))}))}_close(){return this._init(),this._dbp.then(e=>{e.close(),this._dbp=void 0})}}class s{constructor(e){this.executor=e,this.items=[]}async process(){const e=this.items;this.items=[],await this.executor(e.map(({item:e})=>e)),e.map(({onProcessed:e})=>e()),this.items.length?this.ongoing=this.process():this.ongoing=void 0}async queue(e){const t=new Promise(t=>this.items.push({item:e,onProcessed:t}));return this.ongoing||(this.ongoing=this.process()),t}}let r;function i(){return r||(r=new t),r}const o={};return e.Store=t,e.get=function(e,t=i()){let s;return t._withIDBStore("readwrite",t=>{s=t.get(e)}).then(()=>s.result)},e.set=function(e,t,r=i()){return o[r.id]||(o[r.id]=new s(e=>r._withIDBStore("readwrite",t=>{for(const s of e)t.put(s.value,s.key)}))),o[r.id].queue({key:e,value:t})},e.update=function(e,t,s=i()){return s._withIDBStore("readwrite",s=>{const r=s.get(e);r.onsuccess=(()=>{s.put(t(r.result),e)})})},e.del=function(e,t=i()){return t._withIDBStore("readwrite",t=>{t.delete(e)})},e.clear=function(e=i()){return e._withIDBStore("readwrite",e=>{e.clear()})},e.keys=function(e=i()){const t=[];return e._withIDBStore("readwrite",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)},e.close=function(e=i()){return e._close()},e}({});